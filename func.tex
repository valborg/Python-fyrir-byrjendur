\chapterimage{chapters10.png} % Chapter heading image

\chapter{Föll}\index{Föll}\label{k:föll}
\textbf{Föll} (e. functions), eins og lykkjur, eru kóðabútar sem má keyra oft.
Þau líkjast hins vegar skilgreiningum eða uppskriftum frekar en lykkjum þar sem það þarf að \emph{nota} þau til þess að þau geri eitthvað ekki, bara búa þau til.

Ágætar samlíkingar fyrir föll eru til dæmis stærðfræðilegar skilgreiningar, uppskriftir eða réttir á matseðli.

\begin{itemize}
	\item Stærðfræðilega skilgreiningin á hring er eftirfarandi: ,,Hringur er safn punkta í gefinni fjarlægð frá ákveðinni miðju“ sem þýðir að til þess að búa til hring þarf einhverja miðju og teikna svo punkta í einhverjum tilteknum radíus frá þeirri miðju.
	Skilgreining þessi réttir okkur ekki hring með miðju í punkti (0,0) og radíus 3 þegar við setjum hana fram.
	En vegna þess að við eigum hana getum við notað hana til þess að búa til alla þá hringi sem okkur hentar.
	\item Uppskrift í matreiðslubók er ákveðin runa af aðgerðum sem þarf að framkvæma, eins og kom fram í kafla \ref{uk:keyra-koda} um hnetusmjörssamlokuna.
	Það að skrifa niður röð aðgerðanna og það sem þarf til er ekki jafngilt því að framkvæma aðgerðirnar og enda með matinn í höndunum.
	\item Réttur á matseðli er skilg¸reindur á ákveðinn hátt, með ákveðnu meðlæti og þess háttar.
	Við gætum þó viljað gera breytingu á þessari skilgreiningu til þess að fá mat sem er okkur meira að skapi en það sem kokknum datt í hug.
	Það gerum við með því að biðja um skilgreininguna á réttinum nema með breytingum.
\end{itemize}

Höfum þessar samlíkingar í huga þegar kemur að því að skrifa og beita föllum, því það hjálpar að átta sig á því strax að þegar við skilgreinum föll þá búum við til uppskrift sem hægt er að fylgja án þess þó að biðja vélina um að fylgja þeim.

Við höfum séð föll áður, eins og: 

\begin{itemize}
	\item \texttt{print("fyrsta viðfangið", "næsta viðfang sem fallið tekur", "print er sér á báti, því það tekur við svo mörgum viðföngum")}
	\item \texttt{len("breyta sem ég vil vita lengdina á")}
	\item \texttt{range(0,50)}
	\item \texttt{type("breyta sem viðfang sem ég vil vita týpuna á")}
\end{itemize}

Þetta eru innbyggð föll.\footnote{\href{https://docs.python.org/3/library/functions.html}{Python skjölunin} inniheldur lista og upplýsingar um öll innbyggð föll (og aðsjálfsögðu margt fleira).}
Að þau séu innbyggð þýðir að við getum notað þau án þess að ná í einhvern annan kóða (sjá kafla \ref{k:import}) og eru þau flest svo gagnleg að ákveðið var að gefa notendum auðveldara aðgengi að þeim.

Við höfum þó séð fleiri föll sem eru aðferðir (e. methods), munurinn liggur í því að aðferð er hengd aftan á hlut með punkti og er fall sem keyrir á þann hlut.
Fall hins vegar keyrir þegar kallað er í það og óþarfi er að hengja það við eitthvað annað.
Allar aðferðir eru föll, en ekki öll föll eru aðferðir.

Til dæmis sáum við aðferðirnar .capitalize() á strengi og .sort() á lista.

Föll (e. function) og aðferðir (e. methods) eru aðgreinanlegar að þessu leiti, föll eru skilgreind og virka eins og þau eiga að gera fyrir þau gögn sem þau eiga að virka á en aðferðir eru fastar við hlut og eiga að verka á þann hlut.

Við sjáum svo í öðrum hluta bókarinnar hvernig við skilgreinum aðferðir.

\section{Tilgangur falla}\index{Tilgangur falla}
 \begin{wrapfigure}{l}{0.21\textwidth} %i o r l 
	\begin{center}
		\includegraphics{doodles31-04.png}
	\end{center}
\end{wrapfigure}
Eins og með allt annað sem við lærum er gott að vita hvers vegna við erum á annað borð að læra um það.
Ástæðan fyrir því að við viljum læra um föll er að þau eru eitthvað það öflugasta sem við beitum í forritun, skoðum eftirfarandi lista til að skilja hvers megnug þau eru:

\begin{itemize}
	\item Við getum endurnýtt föll í stað þess að skrifa upp sama kóðann á bak við þau á mörgum stöðum.
	\item Við getum gert föll aðgengileg út fyrir skjalið þar sem við skilgreindum þau.
	\item Við getum unnið með inntak frá notanda á skilvirkan máta.
	\item Föll halda utan um einhverja tiltekna virkni sem við viljum hafa aðgang að og eru skilvirk leið til að afmarka virkni.
\end{itemize}

Við höfum hingað til ekki fengist við meira en að átta okkur á grunnvirkni í forritun með hjálp Python, en nú erum við komin á þann stað að við getum farið að leysa flókin vandamál.


\section{Að skilgreina föll}
Til þess að skrifa föll þurfum við að læra nýtt lykilorð, \textbf{def}.
Það stendur fyrir \emph{define} eða að skilgreina, þar sem við erum með því að búa til ákveðna skilgreiningu sem vélin getur svo notað til þess að framkvæma aðgerðir.

Það næsta sem þarf er að búa til nafn á fallið, nafnið er það sem við notum til þess að beita fallinu okkar eftir að hafa skilgreint það.
Alveg eins og með aðrar breytur megum við ekki nota föll fyrr en búið er að skilgreina þau.


 \begin{wrapfigure}{r}{0.28\textwidth} %i o r l 
	\begin{center}
		\includegraphics[scale=1.3]{doodles31-24.png}
	\end{center}
\end{wrapfigure}

Þegar það er komið getum við byrjað að forrita virkni fallsins okkar, allt sem er a.m.k. einum inndrætti innar en \texttt{def} lykilorðið, tilheyrir fallinu okkar.

Í kóðabút \ref{lst:foll-skilgreining} sjáum við hvernig á að búa til skilgreininguna og svo hvernig á að beita fallinu sem við bjuggum til.
Við ætlum að skoða minni úr forritun\footnote{Venjulega er það fyrsta sem er gert í nýju forritunarmáli er að prenta út á staðalúttak \texttt{Halló Heimur!} þetta er skemmtileg hefð sem óþarfi er að gera miklar breytingar á. Hér er \textit{minni} orð úr bókmenntafræðum.} og prenta út einfalda setningu.

Takið eftir að fallið er skilgreint og svo er það sem er inndregið undir því það sem fallið gerir, fyrir neðan skilgreininguna (ekki lengur inndregið undir henni) er svo kallað í fallið með því að skrifa nafnið á því og tóma sviga fyrir aftan nafnið.
Svigarnir eru nauðsynlegir því að þannig segjum við vélinni að við séum að kalla í fall.

\begin{lstlisting}[caption=Föll skilgreind, label=lst:foll-skilgreining]
def prentunarfall():
	print("Halló Heimur!")

prentunarfall()
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
Halló Heimur!
\end{lstlisting}
\lstset{style=venjulegt}

Ástæðan fyrir því að svigarnir eru tómir í línu 4 er vegna þess að þeir eru tómir í línu 1 í skilgreiningunni.
Prófið að setja eitthvað á annan staðinn en ekki hinn og keyra svo kóðann.

\section{Viðföng}
Nú höfum við séð að hægt er að búa til skilgreiningar á föllum, en tökum eftir að í kóðabút \ref{lst:foll-skilgreining} þá eru tómir svigar fyrir aftan nafnið á fallinu.
Þessir svigar eru ekki þarna að ástæðulausu og þeir eru ekki tómir í þessum kóðabút að ástæðulausu heldur.

Það sem fer inn í svigana eru svo kölluð \emph{viðföng} (e. arguments).
Viðföngin skiptast í tvær tegundir, \textbf{stöðubundin} (e. postitional) og \textbf{sjálfgefin} (e. named).
Hægt er að nota bæði í bland og eina viðmiðið er að gefa kost á þeim viðföngum sem notandinn ætti að hafa eitthvað um að segja.

\begin{lstlisting}[caption=Föll með viðföngum, label=lst:foll-vidfong]
def prentunarfall(vidfang):
	print("Halló", vidfang, "!")
	
prentunarfall("Valborg")
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
Halló Valborg!
\end{lstlisting}
\lstset{style=venjulegt}

Annað sem mikilvægt er að átta sig á er að viðföng fá breytuheiti sem eru aðeins aðgengileg innan fallsins en ekki utan þess.
Breytan \texttt{vidfang} er til að mynda aldrei formlega skilgreind eins og við erum vön, allt í einu er hún bara komin þarna inn í svigann í línu 1 og strax notuð í línu 2.
Það er í rauninni ekki keyrsluröðin, það sem gerist er að vélin fær skilgreininguna á \texttt{prentunarfall} og að þeirri skilgreiningu fylgi einhver staðhaldari sem mun seinna fá eitthvað gildi.
Það er það sem gerist í línu 4, við gefum breytunni gildið \texttt{"Valborg"}.

Við ætlum þá að skoða nýtt hugtak áður en við skoðum stöðubundin og sjálfgefin viðföng til þess að átta okkur á því hvar þessi staðhaldari er í raun til.

\subsection{Gildissvið}\label{uk:gildissvið}
\textbf{Gildissvið} (e. scope) skiptist í \textit{staðvært} (e. local) og \textit{víðvært} (e. global). 
Gildissvið merkir hvar eitthvað er aðgengilegt.
Ef við búum til Jupyter vinnubók eða .py skjal þar sem við skilgreinum breytuna \texttt{x} er sú breyta ekki aðgengileg í öðru skjali.
Ef við búum hins vegar til breytu í vinnubók í einhverri sellu, með engum inndrætti, er sú breyta hluti af viðværu gildissviði og er aðgengileg öllum sellum og allri virkni sem við viljum beita þessari breytu í.
Þegar við skilgreinum föll förum við inn á staðvært gildissvið sem þýðir að þegar kallað er í breytu byrjar vélin á að skoða hvort breytan sé skilgreind innan þess sviðs, ef ekki þá notar hún víðværa gildissviðið.
En ef okkur langar að nota breytu sem var skilgreind innan einhvers falls (einhvers staðværs gildissviðs) höfum við ekki aðgang að henni í hinu víðværa gildissviði.

Þetta virðist ótrúlega flókið í svona tæknilegu og löngu máli en skoðið kóðabút \ref{lst:foll-gildissvid} og sjáið hvaða \texttt{x} er verið að vísa í hverju sinni.
Það \texttt{x} sem er skilgreint í línu 1 er hluti af víðværu gildissviði og það sem er skilgreint innan fallsins í línu 3 er hluti af staðværu gildissviði.
Þetta eru því tvö mismunandi \texttt{x} sem hafa ekki áhrif hvort á annað.

\begin{lstlisting}[caption=Gildissvið, label=lst:foll-gildissvid]
x = 20
def gildissvids_prufa(x):
	x = x + 20
	print(x)

gildissvids_prufa(10)

def prufa_tvo():
	print(x)

prufa_tvo()
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
30
20
\end{lstlisting}
\lstset{style=venjulegt}

Það má líta á þetta eins og að horfa á gosbrunn, víðværa gildissviðið er þar sem vatnið kemur upp efst í brunninum og svo fellur það niður í staðværa gildissviðið sem er neðri hluti brunnsins.
Allt sem er til í efri hlutanum getur neðri hlutinn fengið en það sem er í neðri hlutanum fer ekki upp (í þessari samlíkingu ætlum við að horfa fram hjá innri virkni gosbrunnsins og sjá bara fyrir okkur hvernig er að horfa á fallegan gosbrunn sem er á tveimur eða fleiri hæðum).

Ástæða þess að mikilvægt er að nefna gilssvið að svo stöddu er að byrjendur vilja oft ruglast á breytunotkun með þessum hætti og halda að viðföng séu skilgreindar breytur sem hægt er að láta fallið hafa aftur, þegar það er líkara hugmyndinni um breytuna en ekki breytan sjálf.

Þetta skýrist þegar við skoðum stöðubundin viðföng.

\subsection{Stöðubundin viðföng}
\textbf{Stöðubundin viðföng} (e. postitional arguements) fá nafn og röðun þegar þau eru sett í skilgreiningu á falli.
Nöfnin á þeim lúta sömu lögmálum og nafnavenjur sem við höfum séð á breytum og er best að hafa nöfnin lýsandi fyrir virkni þeirra.

Þegar við köllum í fall sem skilgreint er með einu viðfangi og við gefum því engin viðföng þá fáum við villu, villumeldingin sem við fáum upp segir að það vanti eitt stöðubundið viðfang.
Í kóðabút \ref{lst:foll-villa-vidfang} sjáum við þessa villu og í kóðabút \ref{lst:foll-stodubundin-kynning} sjáum við hvernig má komast hjá henni og þá hvernig viðföngin eru í raun stöðubundin.
Í kóðabút \ref{lst:foll-stodubundin-betra} sjáum við loks hvernig breytuheitin geta hjalpað okkur við notkun viðfanganna.

\begin{lstlisting}[caption=Villumelding fyrir ranga notkun á viðföngum, label=lst:foll-villa-vidfang]
def fall_sem_tekur_vid_streng(strengur):
	print(strengur.capitalize())
fall_sem_tekur_vid_streng()
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-128-0e947c4208c2> in <module>
1 def fall_sem_tekur_vid_streng(strengur):
2         print(strengur.capitalize())
----> 3 fall_sem_tekur_vid_streng()

TypeError: fall_sem_tekur_vid_streng() missing 1 required positional argument: 'strengur'
\end{lstlisting}
\lstset{style=venjulegt}

Hér sjáum við að breytuheitið okkar hjálpar okkur við að sjá hvað það er sem við eigum að setja inn, það er einhvers konar strengur.
Það er ekki breytan \texttt{strengur} því að þá fengjum við nafnavillu (við eigum enga breytu sem heitir \texttt{strengur}).

Við þurfum þá að kalla í fallið og setja eitthvað inn í svigann þegar við köllum í það, eins og 'Halló Heimur!' sem myndi þá prenta út "Halló heimur!".

Nú viljum við skoða röðunina á viðföngunum ef fallið tekur við nokkrum.
Athugum svo að það skiptir máli í hvað röð viðföngin eru sett inn, í línum 4-6 í kóðabút \ref{lst:foll-stodubundin-kynning} er verið að setja inn fyrir \texttt{a}, \texttt{b} og \texttt{c} en aldrei í sömu röð og því er úttakið alltaf mismunandi.

\begin{lstlisting}[caption=Stöðubundin viðföng kynnt, label=lst:foll-stodubundin-kynning]
def fall(a,b,c):
	print(a**b/c)

fall(1,2,3)
fall(2,3,1)
fall(3,1,2)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
0.3333333333333333
8.0
1.5
\end{lstlisting}
\lstset{style=venjulegt}

Athugum að í kóðabút \ref{lst:foll-stodubundin-kynning} er hvorki nafnið á fallinu né á viðföngum þess sérlega lýsandi.
Nafnið á fallinu gefur ekki til kynna hvað það gerir og nöfnin á viðföngunum segja ekkert til um hvernig þau verða notuð eða af hvaða týpu þau eiga að vera.
Þetta fall væri mögulega nothæft fyrir okkur sjálf, en um leið og annað fólk á að fara að nota kóðann okkar þá er eins gott að venja sig af því að nota svona ógagnsæjar nafnavenjur.
Fyrir þessa tilteknu formúlu væri betra að finna eitthvað nafn á hana eða nefna fallið eftir nákvæmri virkni formúlunnar og nefna svo viðföngin eftir því hvar þau eru sett inn í formúluna.

%\begin{wrapfigure}{i}{0.21\textwidth} %i o r l 
	\begin{center}
		\includegraphics{doodles31-31.png}
	\end{center}
%\end{wrapfigure}

Hingað til hafa öll föllin okkar verið að prenta út, við viljum geta gert eitthvað annað en það.
Við sjáum í kafla \ref{uk:skilagildi} hvað hægt er að gera annað en að prenta bara út.

Lítum á kóðabút \ref{lst:foll-stodubundin-betra} til að sjá hvernig betur mætti fara með skilgreininguna úr kóðabút \ref{lst:foll-stodubundin-kynning}.
Takið eftir að úttakið er að sjálfsögðu það sama því að kallað er í fallið með sömu tölum, það eina sem breytist er að nú vitum við hvað er að fara inn fyrir hvað í útreikningunum.

\begin{lstlisting}[caption=Stöðubundin viðföng með skýrari breytuheitum, label=lst:foll-stodubundin-betra]
def hefja_i_veldi_og_deila(grunntala,veldisvisir,deiling):	
	print(grunntala**veldisvisir/deiling)

hefja_i_veldi_og_deila(1,2,3)
hefja_i_veldi_og_deila(2,3,1)
hefja_i_veldi_og_deila(3,1,2)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
0.3333333333333333
8.0
1.5
\end{lstlisting}
\lstset{style=venjulegt}

Ef við rifjum upp hugtakið gildissvið úr fyrri undirkafla og skoðum hvernig það á við um kóðabút \ref{lst:foll-stodubundin-betra} sjáum við að fallið heitir \texttt{hefja\_i\_veldi\_og\_deila}.
Það tekur við þremur viðföngum sem verður að setja inn í þeirri röð sem fallið kallar eftir þeim, fyrst grunntöluna svo töluna sem á að nota sem veldisvísi og svo loks töluna sem á að deila með.

Nú er við hæfi að taka fram hvers konar byrjendamistök eru algeng hérna, en ef meiri skilningur værir fyrir hendi á því hvernig gildissvið virka ættu þessi mistök sér sjaldnar stað.
Það er að breyturnar \texttt{grunntala}, \texttt{veldisvisir} og \texttt{deiling} eru hluti af staðværu gildissviði þessa falls, neðri hluta brunnsins sem efri hlutinn getur ekki sótt vatn úr.
Þess vegna getum við ekki kallað í fallið svona: \texttt{hefja\_i\_veldi\_og\_deila(grunntala,veldisvisir,deiling)} (það er skrifað inn í nöfnin á viðföngunum eins og við eigum þau til sem breytur) því að þá erum við að biðja víðværa gildissviðið (efri hluta brunnsins) um að finna hjá sér einhverjar breytur sem heita þetta til þess að setja inn í staðinn fyrir þessar skilgreiningar.

Hér getum við aftur horft til skilgreiningar hrings og búið til fall sem lýsir því hvernig á að teikna hring með ákveðna miðju og tiltekinn radíus.
Efiii  okkur langar til að fá einhvern hring í hendurnar getum við ekki sagt við vélina láttu okkur hafa hring með radíus \texttt{radius} nema að breytan \texttt{radius} hafi þegar fengið gildið sem við ætluðum að nota.

\begin{wrapfigure}{i}{0.3\textwidth} %i o r l 
	\begin{center}
		\includegraphics{doodles31-14.png}
	\end{center}
\end{wrapfigure}
Vélin, ef við manngerum hana örlítið, myndi þá segja ,,það er það sem þú átt að segja mér, hvað radíus er, ég veit ekkert hvað það er!“
Til þess að nota fallið þurfum við að gefa annað hvort upp gögn af týpunni sem um var beðið eða breytu sem er aðgengileg utan fallsins (annað hvort úr víðværu gildissviði eða víðara staðværu gildissviði) sem inniheldur gögn af týpunni sem um var beðið.

Tölvan reynir ekki að hafa vit fyrir okkur, hún lagar ekki inntakið þegar við setjum það augljóslega í ranga röð.
Hún annað hvort vinnur með vitlausa inntakið okkar og við fáum í hausinn eitthvað úttak sem við skiljum ekki eða við fáum villu.
Kíkið á kafla \ref{k:villur} til þess að skoða hvernig má taka á því þegar upp koma villur en við viljum að kóðinn okkar haldi samt áfram að keyra.



\subsection{Sjálfgefin viðföng}\label{uk:föll-sjálfgefin}
Ef við viljum vera viss um að við getum unnið með eitthvað viðfang án þess að neyða notandann til þess að gefa okkur það getum við notað \textbf{sjálfgefin viðföng} (e. named arguments, default arguments), einnig kölluð \textit{nefnd viðföng}.
Þá skilgreinum við fall og búum til skilgreiningu á viðföngunum þar sem við tökum þau fram.
Skoðum þetta í kóðabút \ref{lst:foll-sjalfgefin} en þar sjáum við hvernig má nota bæði stöðubundin og sjálfgefin viðföng saman og hvernig má kalla í föll sem eru með bæði.

Þegar bæði er notað saman í bland þarf að setja stöðubundnu viðföngin fremst og sjálfgefnu viðföngin koma svo á eftir þeim.

Athugum að bæði er í lagi að nota sjálfgefin viðföng sem stöðubundin, en þá verðum við líka að setja þau inn í réttri röð, og hins vegar að skrifa inn nafnið á viðfanginu og skilgreina það sem eitthvað (hvort sem það eru einhver gögn sem við setjum beint inn eða notum breytu).
Einnig er í lagi að sleppa því að taka þau fram.

%\begin{wrapfigure}{i}{0.21\textwidth} %i o r l 
	\begin{center}
		\includegraphics[scale=1.9]{doodles31-30.png}
	\end{center}
%\end{wrapfigure}
\newpage
\begin{lstlisting}[caption=Sjálfgefin viðföng kynnt, label=lst:foll-sjalfgefin]
def hefja_i_veldi_og_deila(grunntala = 1,veldisvisir = 1,deiling = 1):	
	print(grunntala**veldisvisir/deiling)
	
hefja_i_veldi_og_deila()
hefja_i_veldi_og_deila(2, 2, 2)
hefja_i_veldi_og_deila(deiling = 2)
hefja_i_veldi_og_deila(deiling = 2, veldisvisir = 1, grunntala = 4)

def hefja_i_veldi_og_deila_2(grunntala,veldisvisir,deiling = 1):	
	print(grunntala**veldisvisir/deiling)

print()
hefja_i_veldi_og_deila_2(1,2) 
hefja_i_veldi_og_deila_2(1, 2, 2) 
hefja_i_veldi_og_deila_2(1, 2, deiling = 4) 

print()
tala = 2
veldi = 2
deila = 2
hefja_i_veldi_og_deila_2(tala, veldi, deiling = deila)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
1.0
2.0
0.5
2.0

1.0
0.5
0.25

2.0
\end{lstlisting}
\lstset{style=venjulegt}

Skoðið hér hvernig er kallað í fallið \texttt{hefja\_i\_veldi\_og\_deila} í línum 4-7 í kóðabút \ref{lst:foll-sjalfgefin} og berið það saman við hvernig var kallað í föllin í kóðabútum \ref{lst:foll-villa-vidfang} og \ref{lst:foll-stodubundin-betra}.
Þar þurfti alltaf að setja inn öll viðföng, annars fékkst villa. 
Vegna þess að í  skilgreiningunni kom fram að sjálfgefin gildi eru ákveðnar tölur sem hægt er að nota í útreikningum lendir vélin ekki í vandræðum þegar einhver viðföng vantar.

Að sjálfsögðu megum við ekki setja inn of mörg viðföng, þá lendum við í vandræðum.
Prófið ykkur áfram með það.

Takið líka eftir að í línu 7 er kallað í viðföngin í ,,rangri“ röð með því að nota nöfnin á þeim.
Prófið að gera það með línu 21, að setja breyturnar inn fyrir viðföngin í annarri röð.
Takið eftir því að stöðubundnu viðföngin verða að koma á undan.

Í línu 5 og 14 er kallað eins í föllin, þá er komið fram við sjálfgefnu viðföngin eins og stöðubundin.
Viðföngin eru sett inn í sömu röð og skilgreining fallanna í línum 1 og 9.

Eins og hefur komið fram er nauðsynlegt að gera tilraunir og prófanir til að ná árangri og skilningi á efninu.


\section{Skilagildi}\label{uk:skilagildi}
Nú höfum við séð hvernig á að búa til föll, við höfum séð hvernig á að láta föllin vinna með viðföng.
Það næsta sem við viljum skoða er hvernig á að láta föllin okkar skila útkomu sem má nota áfram.
Við höfum séð hvernig aðferðir á strengi skila oft til okkar öðrum streng sem byggir á strengnum sem við notuðum aðferðina á (sjá kafla \ref{uk:strengjaaðferðir}), til þess að geta notað útkomuna getum við búið til breytu sem grípur það sem aðferðin \textit{skilar}.

Í kóðabútum \ref{lst:foll-stodubundin-betra} og \ref{lst:foll-sjalfgefin} er fallið \texttt{hefja\_i\_veldi} skilgreint, en aldrei er hægt að vinna eitthvað með útkomuna úr útreikningnum, útkoman er bara prentuð.
Ef við þurfum að nota útreikninginn þá dugar okkur ekki að þurfa að horfa á það sem vélin skrifar út og skrifa það handvirkt inn sjálf.
Það sem við viljum geta sagt er ,,hey reiknaðu þetta út og notaðu það svo hér, mér er alveg sama hvað það er því að ég treysti því að þú hafir gert það rétt“.
Við manngerum tölvuna að sjálfsögðu, hvað gæti farið úrskeiðis?

Til þess að geta nýtt þessa virkni þurfum við að læra nýtt lykilorð, \textbf{return} en það þýðir skila, mjög gagnsætt og gott lykilorð.\footnote{Eins og flest lykilorðin sem við höfum séð hingað til, að mati höfundar.}
Það sem lykilorðið gerir er svipað \emph{break} lykilorðinu, þegar vélin kemur að línu þar sem \texttt{return} kemur fram gerir fallið ekkert meira en að skila því sem beðið er um og vélin heldur áfram í næstu línu frá því kallað var í fallið.
Sjáum kóðabút \ref{lst:foll-skilagildi}.

\begin{lstlisting}[caption=Hvernig á að láta fall skila gildi með return skipuninni, label=lst:foll-skilagildi]
def hefja_i_veldi_og_deila(grunntala,veldisvisir,deiling = 1):
	print('kallað var í fallið')
	return grunntala**veldisvisir/deiling
	
print("í hvaða röð gerast hlutirnir?")
utkoma = hefja_i_veldi_og_deila(2, 2, 2)
print("útkoman var", utkoma, "og hún margfölduð með tveimur er", utkoma*2)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
í hvaða röð gerast hlutirnir?
kallað var í fallið
útkoman var 2.0 og hún margfölduð með tveimur er 4.0
\end{lstlisting}
\lstset{style=venjulegt}

\phantom{easter egg}
\begin{wrapfigure}{i}{0.2\textwidth} %i o r l 
	\begin{center}
		\includegraphics[scale=0.9]{doodles31-13.png}
	\end{center}
\end{wrapfigure}
 
Nú höfum við skilað einu gildi sem er fleytitala og unnið með hana með þeim reiknivirkja sem okkur langaði til að prófa.
Hægt er að skila gögnum af hvaða týpu sem er, og jafnvel fleiru en einu gildi í einu, og það af mismunandi týpum.

Sjáum í kóðabút \ref{lst:foll-ndir-skilagildi} hvernig hægt er að skila mörgum gildum og setja þau í breytu eða breytur.
Það sem fallið tekur við er strengur, tala og listi.
Fallið skilar tveimur tölum og listanum aftur óbreyttum
Fyrri talan er hversu oft strengurinn í viðfanginu kom fyrir í listanum.
Seinni talan er hversu margar tölur í listanum eru stærri en talan í viðfanginu.


\begin{lstlisting}[caption=Hvernig á að skila mörgum gildum, label=lst:foll-ndir-skilagildi]
def skilum_morgum_gildum(strengur, tala, listi):

	skilatala = 0
	strengja_talning = 0
	for stak in listi:
		# x stendur fyrir það stak sem verið er skoða úr listanum listi
		if stak == strengur:
			strengja_talning +=1
		if(type(stak) == int or type(stak) == float ):
			if (tala < stak):
				skilatala += 1
	return strengja_talning, skilatala,  listi
\end{lstlisting}

Nú þegar við erum búin að skilgreina fallið þá getum við notað það og vegna þess að við viljum skoða nokkrar mismunandi leiðir brjótum við það upp í nokkra kóðabúta.
Verið viss um að vera búin að keyra kóðann í bút \ref{lst:foll-ndir-skilagildi} áður en þið keyrið kóðann úr næstu kóðabútum.


\begin{lstlisting}[caption=Fallið úr kóðabút \ref{lst:foll-ndir-skilagildi} notað án þess að útkoman sé geymd, label=lst:foll-skil1]
skilum_morgum_gildum("halló", 2, ["halló", "bless", 11, 6])
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
# ekkert gerist
\end{lstlisting}
\lstset{style=venjulegt}

Hér gerðum við ekkert við útkomuna, við kölluðum vissulega í fallið og útreikningarnir voru framkvæmdir en við höfum ekkert í höndunum um það.
Reynum að setja útkomuna í breytu eins og við höfum gert ótal sinnum áður.

\begin{lstlisting}[caption=Fallið úr kóðabút \ref{lst:foll-ndir-skilagildi} notað og útkoman geymd í einni breytu, label=lst:foll-skil2]
utkoma = skilum_morgum_gildum("halló", 2, ["halló", "bless", 11, 6])
print(utkoma)
print(type(utkoma))
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
(1, 2, ['halló', 'bless', 11, 6])
<class 'tuple'>
\end{lstlisting}
\lstset{style=venjulegt}

Þegar mörgum skilagildum er komið fyrir í einni breytu er þeim komið því fyrir sem nd.
Við munum að hægt er að úthluta stökum ndar í nokkrar breytur í einu skrefi.

\begin{lstlisting}[caption=Fallið úr kóðabút \ref{lst:foll-ndir-skilagildi} notað og skilagildunum úthlutað í breytur rétt, label=lst:foll-skil3]
talning_strengs, staerri_tolur, listinn = skilum_morgum_gildum("halló", 2, ["halló", "bless", 11, 6])

print("Hversu oft kom strengurinn fyrir:", talning_strengs)
print("Hversu margar tölur voru stærri en 2:", staerri_tolur)
print("listinn óbreyttur:", listinn)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
Hversu oft kom strengurinn fyrir: 1
Hversu margar tölur voru stærri en 2: 2
listinn óbreyttur: ['halló', 'bless', 11, 6]
\end{lstlisting}
\lstset{style=venjulegt}

Við munum einnig að við þurfum að úthluta öllum stökum í eina ákveðna breytu og því virkar eftirfarandi kóðabútur ekki.

\begin{lstlisting}[caption=Fallið úr kóðabút \ref{lst:foll-ndir-skilagildi} notað og skilagildunum úthlutað í breytur rangt, label=lst:foll-skil3]
a, b = skilum_morgum_gildum("halló", 2, ["halló", "bless", 11, 6])
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-143-dc266568ff5c> in <module>
----> 1 a, b = skilum_morgum_gildum("halló", 2, ["halló", "bless", 11, 6])

ValueError: too many values to unpack (expected 2)
\end{lstlisting}
\lstset{style=venjulegt}

\section{Innri föll}\index{Innri föll}

Föll mega innihalda önnur föll, athugum það sem við fórum yfir í kafla \ref{uk:gildissvið}.
Þessi föll geta verið gagnleg til að útfæra útreikning sem er svo notaður oft innan fallsins.
Sjáum dæmi í kóðabút \ref{lst:foll-innri-foll}, athugið sérstaklega gildissviðið því að í innra fallinu er vísað í viðfang sem heitir strengur og það er líka vísað í viðfang í ytra fallinu sem heitir strengur.
Vegna þess að gildissviðið krefst þess að fyrst sé athugað staðvært hvernig breytan er skilgreind skiptir ekki máli að breyturnar heiti það sama.

\newpage
\begin{lstlisting}[caption=Innri föll kynnt, label=lst:foll-innri-foll]
def breyta_strengjum(strengur):
	def fremsti_stafur_er_nuna_aftastur(strengur):
		if(len(strengur) > 2):
			fremst = strengur[0]
			aftast = strengur[-1]
			strengur = aftast + strengur[1:-1] + fremst
			return strengur
		else:
			return strengur

	skilastrengur = fremsti_stafur_er_nuna_aftastur(strengur)
	return skilastrengur
\end{lstlisting}

Eins og áður er fallið skilgreint fyrst og svo skoðum við frekari notkun í næstu kóðabútum.
Athugum sérstaklega að það er bara eitt innra fall þarna og það er ekki ýkja merkilegt, það tekur fremsta og aftasta tákn í streng og víxlar þeim.
Við gætum verið með mörg önnur föll og kallað í þau handahófskennt byggt á einhverju eins og hvaða tákn er í þriðja vísi eða álíka.
Aðalatriðið hér er að sýna að það er fall sem heitir \texttt{fremsti\_stafur\_er\_nuna\_aftastur} og það er einungis hægt að kalla í það innan fallsins \texttt{breyta\_strengjum}.
Takið vel eftir inndrætti og því að vissulega er kallað í innra fallið í línu 11.

Köllum nú í fallið með einhverju viðfangi og sjáum hvað gerist.

\begin{lstlisting}[caption=Ytra fallið notað, label=lst:foll-innri-foll-ut1]
strengur = breyta_strengjum("halló")
print(strengur)
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
óallh	
\end{lstlisting}
\lstset{style=venjulegt}

Og nú sjáum við að við getum ekki kallað í innra fallið því að við höfum ekki aðgang að því.

\begin{lstlisting}[caption=Innra fallið notað þar sem ekki er aðgangur að því, label=lst:foll-innri-foll-ut2]
strengur =  fremsti_stafur_er_nuna_aftastur("halló")
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-147-970f41b86e0c> in <module>
----> 1 strengur =  fremsti_stafur_er_nuna_aftastur("halló")

NameError: name 'fremsti_stafur_er_nuna_aftastur' is not defined
\end{lstlisting}
\lstset{style=venjulegt}


Nú höfum við séð hvernig má skilgreina innri föll og það sem við ætlum að skoða næst er að það má skila föllum.
Skipunin \texttt{return} er þá notuð alveg eins og ef við værum að skila einu gildi, eða fleirum.
Við sjáum í kóðabút \ref{lst:foll-lokun} hvernig við skilum falli og hvernig á að nota skilagildið sem inniheldur fallið.
Í seinni hluta þessarar bókar, í umfjöllun um klasa, sjáum við hvernig má framkvæma sömu virkni.
Ef það skiptir máli að eitthvað sé gert hratt sem má leysa með \emph{lokun} (e. closure) þá ætti frekar að beita henni heldur en klösum.

\phantom{easter egg}
%\begin{wrapfigure}{i}{0.2\textwidth} %i o r l 
	\begin{center}
		\includegraphics[scale=1.4]{doodles31-12.png}
	\end{center}
%\end{wrapfigure}

\begin{lstlisting}[caption=Lokun kynnt, label=lst:foll-lokun]
def prentunarfall(strengur):
	def prentum():
		return str(strengur) + " hér er viðbót af akademískri ástæðu"
	return prentum
	
a = prentunarfall('halló heimur')
print(a) 
print(a())

b = prentunarfall('nýr strengur')
print(b())
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
<function prentunarfall.<locals>.prentum at 0x7fce9ed740d0>
halló heimur hér er viðbót af akademískri ástæðu
nýr strengur hér er viðbót af akademískri ástæðu
\end{lstlisting}
\lstset{style=venjulegt}

Úttakið hér minnir okkur á strengjaaðferðir (kafli \ref{uk:strengjaaðferðir}) þar sem við þurftum að muna að nota sviga til að kalla í aðferðirnar okkar.
Það er vegna þess að \texttt{a} er fall, það sem \texttt{prentunarfall} skilar er fall sem þarf að kalla í með svigum til að nota.

Þetta er ekki sérlega merkilegt fall, það hermir eftir virkni sem við þekkjum vel úr \texttt{print()} fallinu, nema með þessari strengjaviðbót.

Skoðum nú að lokum fall sem er aðeins merkilegra.
Við viljum geta búið til niðurteljara sem telur niður úr einhverri tölu en á einhverjum tilteknum tíma.
Við leysum það með því að skila falli sem telur niður úr þeirri tölu sem fallinu var gefið.


\begin{lstlisting}[caption=Lokun notuð á hagnýtari máta, label=lst:foll-lokun2]
def niðurtalning(n):
	def teljari():
		nonlocal n
		while(n>-1):
			print(n)
			n -= 1
	
	return teljari
	
teljum_fra_fimm = niðurtalning(5)
teljum_fra_tiu = niðurtalning(10)

teljum_fra_fimm()
\end{lstlisting}
\lstset{style=uttak}
\begin{lstlisting}
5
4
3
2
1
0
\end{lstlisting}
\lstset{style=venjulegt}

Tökum eftir að í skilgreiningum á \texttt{a} og \texttt{b} í kóðabút \ref{lst:foll-lokun} erum við að nota ákveðinn streng sem föllin eiga að prenta út.
Þetta er eilítið óhlutstætt á þessu stigi málsins og ekki augljóst hvernig það nýtist okkur því dæmið í kóðabútnum er ekki sérlega nothæft fall.
Niðurtalningarfallið er hins vegar að framkvæma einhverja virkni sem við viljum hafa aðgang að þegar okkur hentar.
Við notum strax \texttt{teljum\_fra\_fimm} en við notum ekkert \texttt{teljum\_fra\_tiu}, það kemur ekki að sök, þið getið beitt því til athugunar.
Því var sleppt til að spara pappír.

Athugum þó sérstaklega að gildissviðið sem innra fallið \texttt{teljari()} tilheyrir hefur ekki aðgang að neinu staðværu n-i svo það skilar villu, nema að við segjum því falli sérstaklega að nota ekki staðvært n heldur leita út fyrir gildissviðið með lykilorðinu \textbf{nonlocal}.
Við munum ekki nota það orð af neinu viti í seinni hluta bókarinnar en það er þess virði að taka það fram að svo stöddu að þetta orð sé til og hvað það gerir.

%-------------------------------ÆFINGAR--------------------------------%
\newpage
\section{Æfingar}
Athugið að til þess að átta ykkur á því hvort að föllin ykkar séu rétt gerð þurfið þið að gera ítarlegar prófanir á þeim, með mismunandi inntaki.
Kallið í föllin í öllum æfingum.

\begin{exercise}\label{fun1}
Búið til fall sem tekur við tveimur stöðubundnum breytum og prentar þær út nema fyrri breytan er prentuð á eftir hinni breytunni.
Prófið að kalla í fallið með streng og tölu, með tveimur strengjum og með tveimur tölum.
\end{exercise}
\setboolean{firstanswerofthechapter}{true}
\begin{Answer}[ref={fun1}]
Við þurfum ekkert að hugsa um \texttt{return} á þessu stigi málsins, bara að muna eftir hvernig á að setja upp fall og nota það.
	\begin{lstlisting}
def fall1(a, b):
	print(b, a)
fall1(1,"halló")
fall1("prufa", "hvað?")	
fall1(2, 4)\end{lstlisting}
\end{Answer}
\setboolean{firstanswerofthechapter}{false}


\begin{exercise}\label{fun2}
Búið til fall sem tekur við þremur nefndum viðföngum, sem eiga að vera strengir.
Ef ekkert er gefið upp ákveðið þið sjálf hvert gildi viðfanganna á að vera.
Innan fallsins athugið þið svo hver strengjanna er aftastur í stafrófinu og prentið hann út.
\end{exercise}
\begin{Answer}[ref={fun2}]
Hér erum við komin í smá vandræði, það er að við viljum að notandinn setji inn strengi í fallið okkar en við gerum ekkert til þess að fullvissa okkur um að svo sé (sjáum það í kafla \ref{k:villur}).
Við ætlum að sjá hvað gerist þegar við notum fallið eins og okkur sýnist þó svo að við vitum að fallið taki bara við strengjum.

Það sem þarf að gerast er einföld skilyrðissetning og útprentun.
Hún er einföld á þann hátt að hún er ekki hreiðruð og við þurfum bara fáa samanburðarvirkja.
Að vísu má sleppa samanburðarvirkjunum með því að nota innbyggt fall sem heitir \texttt{max()}.
Prófið ykkur áfram með að breyta þessari lausn og setja inn þrjá eins strengi.

Lausnin með samanburðinn er ófullkomin því að aldrei er leyfilegt að tveir strengir sem eru aftar í stafrófinu séu jafnir (hvað þá allir þrír).

Reynið að leysa þetta án þess að nota \texttt{max()} inni í \texttt{else}.
\begin{lstlisting}
def fall2(a = "Anna", b = "Bára", c = "Carl"):
	if(a > b and a > c):
		print(a)
	elif(b > a and b > c):
		print(b)
	elif(c > a and c > b):
		print(c)
	else:
		print(max(a,b,c))\end{lstlisting}
\end{Answer}

\begin{exercise}\label{fun3}
Búið til fall sem tekur við lista af tölum og skilar næsthæstu tölunni.
\end{exercise}
\begin{Answer}[ref={fun3}]
Nú getum við aftur beitt \texttt{max()} fallinu en þá til þess að henda þeirri tölu út svo að við getum beitt því aftur.
Athugum að muna eftir því að skila.
	\begin{lstlisting}
def fall3(listi):
	gildi = max(listi)
	listi.remove(gildi)
	haesta = max(listi)
	return haesta

fall3([1,2,3,4,55,66])\end{lstlisting}
\newpage
\end{Answer}

\begin{exercise}\label{fun4}
Búið til fall sem tekur við gildi og lista sem viðföngum og skilar hversu oft gildið kemur fyrir í listanum.
\end{exercise}
\begin{Answer}[ref={fun4}]
Nú þurfum við lykkju fyrir listann, samanburð við gildið og breytu sem heldur utan um talninguna.
Þetta þarf allt að vera skilgreint á réttum stað, í réttum inndrætti, í réttri röð.
	\begin{lstlisting}
def fall4(gildi, listi):
	talning = 0
	for stak in listi:
		if stak == gildi:
			talning += 1
	return talning

fall4(4, [1,2,3,4,5,4,2,3,4,5,4444])
fall4("halló", ["halló", 123, {}, {"halló": "halló"}, ["telst ekki með hér", "halló"]])\end{lstlisting}
\end{Answer}

\begin{exercise}\label{fun5}
Búið til fall sem tekur við tveimur strengjum, ef strengirnir byrja báðir á sérhljóða eða á sama samhljóðanum skilið þið True gildi, annars False.
\end{exercise}
\begin{Answer}[ref={fun5}]
Hér erum við í fyrsta sinn að vinna með skilagildi af týpunni Boolean, spennandi.


	\begin{lstlisting}
def fall5(str1, str2):
	if(str1[0].lower() == str2[0].lower()):
		return True
	elif(str1[0].lower() in "aáeéiíoóuúæyýö" and str2[0].lower() in "aáeéiíoóuúæyýö" ):
		return True
	return False

fall5("breki", "Bolli")
fall5("ester", "Ösp")
fall5("kanína", "Portúgal")
\end{lstlisting}
Hér sjáum við að \texttt{return} False kemur fyrir í sama inndrætti og skilyrðissetningin, má það?
Það er vegna þess að ef við fórum aldrei inn í skilyrðissetninguna, þá gátum við aldrei skilað True og því hljótum við að eiga skila False.
Sama niðurstaða fengist með því að bæta við \texttt{else return False}.
Takið svo eftir \texttt{.lower()} til að staðla inntakið svo við fáum örugglega True fyrir Bolli og breki, og ester og Ösp.

\end{Answer}

\begin{exercise}\label{fun6}
Búið til fall sem tekur við tveimur tölum.
Ef tölurnar eru báðar sléttar skilið þið þeirri tölu sem er lægri.
Ef önnur eða hvorug er slétt skilið þið þeirri tölu sem er hærri.
Nú er gott að benda á að \texttt{min()} skilar minnsta gildi alveg eins og \texttt{max()} skilar hæsta gildi.
\end{exercise}
\begin{Answer}[ref={fun6}]
	Takið sérstaklega vel eftir hér hvað fallið er prófað ítarlega.
	\begin{lstlisting}
def fall6(tala1, tala2):
	if tala1%2 == 0 and tala2%2 == 0:
		return min(tala1, tala2)
	return max(tala1, tala2)

fall6(2, 4)
fall6(1, 3)
fall6(8, 1)
fall6(9, 3)\end{lstlisting}
\newpage
\end{Answer}


\begin{exercise}\label{fun7}
Hér fall sem tekur við lista og athugar hvort stökin 0, 0, 7 komi fyrir í listanum í þessari röð (önnur stök mega vera á milli).
Sem dæmi myndi listinn [1,2,3,0,1,20,0,7] skila True en listinn [7,0,0,0,0,0,6] myndi skila False.
Athugið að eitthvað vantar í fallið og þið þurfið að fylla í eyðurnar.
Breytan talning telur hversu mörg tákn við erum komin með af þeim þremur sem við þurfum.
Við erum fyrst með núll og svo hækkum við talninguna eftir því sem við sjáum táknin í þeirri röð sem við viljum sjá þau.
\begin{lstlisting}
def fall6(listi):
	talning = 0
	for stak in listi:
		if stak == 0 ?? talning == ??:
			talning = 1
		?? stak == 0 ?? talning == ??:
			talning = 2
		?? stak == 7 ?? talning == ??:
			return True
	??

fall6([1,2,3,0,1,20,0,7])
fall6([1,7,0,0,0,0,0,0,0,0])
\end{lstlisting}
\end{exercise}
\begin{Answer}[ref={fun7}]

	\begin{lstlisting}
def fall6(listi):
	talning = 0
	for stak in listi:
		if stak == 0 and talning == 0:
			talning = 1
		elif stak == 0 and talning == 1:
			talning = 2
		elif stak == 7 and talning == 2:
			return True
	return False\end{lstlisting}
	Hér sjáum við að \texttt{return} False kemur fyrir í sama inndrætti for-lykkjan, það er vegna þess að þegar for-lykkjan er búin höfum við ekki náð að finna 7 á eftir tveimur núllum og því skilum við false.
	Sú setning má ekki vera inni í for-lykkjunni því að þá myndum við ekki klára að skoða öll stökin áður en við myndum úrskurða um hvort mynstrið sé til staðar eða ekki.
	
\end{Answer}

\begin{exercise}\label{fun8}
Búið til fall sem tekur við einu viðfangi sem er tala.
Það sem fallið gerir er lausnin á verkefni \ref{nd4} en í stað þess að prenta út ndina á fallið að skila ndinni til baka.
Áður en for-lykkjan er keyrð skulið þið keyra skilyrðissetningu sem athugar hvort viðfangið sé af týpunni heiltala (int), ef svo er ekki skulið þið skila tómri nd.
Þetta er hægt að athuga með \texttt{type()} fallinu og \texttt{int} lykilorðinu.
Munið eftir \texttt{!=} samanburðinum.

Ef viðfangið er heiltala skal halda áfram og sú tala fer inn í range fallið í for-lykkjunni.
Þannig erum við komin með fall sem getur búið til ndir sem spyrja x oft hver uppáhalds litur notandans er.
\end{exercise}
\begin{Answer}[ref={fun8}]
Rifjum upp svarið við \ref{nd4}.
\begin{lstlisting}
nd = ()
for i in range(4):
	svar = input("hver er uppáhalds liturinn þinn?")
	nd = nd + (svar,)
print(nd)\end{lstlisting}

Við vildum nota þetta innan falls og við vildum ekki bara prenta útkomuna heldur skila henni, en við vildum jafnframt aðeins athuga inntakið með skilyrðissetningu.

Prófið fallið með bæði tölu og streng eða öðru tagi.

\begin{lstlisting}
def fall8(x):
	nd = ()
	if type(x) != int:
		return nd

	for i in range(x):
		svar = input("hver er uppáhalds liturinn þinn?")
		nd = nd + (svar,)
	return nd\end{lstlisting}
\newpage
\end{Answer}

