\chapterimage{chapter_head_2.pdf} % Chapter heading image

\chapter{Föll}\index{Föll}\label{k:föll}
Föll (e. functions), eins og lykkjur, eru kóðabútur sem má keyra oft.
Þau líkjast hins vegar frekar skilgreiningum eða uppskriftum frekar en lykkjum þar sem það þarf að nota þau til þess að þau geri eitthvað ekki bara skrifa þau.

Ágætar samlíkingar fyrir föll eru til dæmis stærðfræðilegar skilreiningar, uppskriftir eða réttir á matseðli.

\begin{itemize}
	\item Stærðfræðilega skilgreining á hring er eftirfarandi ,,Hringur er safn punkta í gefinni fjarlægð frá ákveðinni miðju'' sem þýðir að til þess að búa til hring þarf einhverja miðju og teikna svo punkta í einhverjum tilteknum radíus frá þeirri miðju.
	Skilgreining þessi réttir okkur ekki hring með miðju í punkti (0,0) og radíus 3 þegar við setjum hana fram.
	En vegna þess að við eigum hana getum við notað hana til þess að búa til alla þá hringi sem okkur henta.
	\item Uppskrift í bók er ákveðin runa af aðgerðum sem þarf að framkvæma, eins og kom fram í kafla \ref{uk:keyra-koda} um hnetusmjörssamlokuna, það að skrifa niður röð aðgerðanna og það sem þarf til er ekki jafngilt því að framkvæma aðgerðirnar og enda með matinn í höndunum
	\item Réttur á matseðli er skilreindur á ákveðinn hátt, með ákveðnu meðlæti og þess háttar.
	Við gætum þó viljað gera breytingu á þessari skilgreiningu til þess að fá mat sem er okkur meira að skapi en það sem kokknum datt í hug.
	Það gerum við með því að biðja um skilgreininguna á réttinum nema með breytingum.
\end{itemize}

Höfum þessar samlíkingar í huga þegar kemur að því að skrifa og beita föllum, því það hjálpar að átta sig á því strax að þegar við skilgreinum föll þá búum við til uppskrift sem hægt er að fylgja án þess þó að biðja vélina um að fylgja þeim.

Við höfum séð föll áður, eins og: \todo{kynna min og max einhvern tímann áður}

\begin{itemize}
	\item print("fyrsta viðfangið", "næsta viðfang sem fallið tekur", "print er sér á báti, því það tekur við svo mörgum viðföngum")
	\item len("breyta sem ég vil vita lengdina á")
	\item min("breyta sem ég vil fá minnsta gildið úr")
	\item min(nokkrar, tölur, og, ég, vil, vita, hver, er minnst)
	\item range(0,50)
	\item type("breyta sem viðfang sem ég vil vita týpuna á")
\end{itemize}

Þetta eru innbyggð föll, við höfum þó séð fleiri föll sem eru aðferðir (e. methods), munurinn liggur í því að aðferð er hengd aftan á hlut með punkti og er fall sem keyrir á þann hlut en fall keyrir þegar kallað er í það og óþarfi er að hengja það við eitthvað annað.
Allar aðferðir eru föll, ekki öll föll eru aðferðir.

Til dæmis sáum við aðferðirnar .capitalize() á strengi og .sort() á lista.

Föll (e.function) og aðferðir (e. methods) eru aðgreinanlegar að þessu leiti, annað er skilgreint og virkar eins og það á að gera fyrir þau gögn sem þau eiga að virka á en aðferðir er eitthvað sem er fast við hlut og eiga að verka á þann hlut.

Við sjáum svo í öðrum hluta bókarinnar hvernig við skilgreinum aðferðir.

\section{Tilgangur falla}\index{Tilgangur falla}
Eins og með allt annað sem við lærum er gott að vita hvers vegna við erum á annað borð að læra það.
Ástæðan fyrir því að við viljum læra um föll er að þau eru eitthvað það öflugasta sem við beitum í forritun, skoðum eftirfarandi lista til að skilja hvers megnug þau eru:

\begin{itemize}
	\item Við getum endurnýtt föll í stað þess að skrifa upp sama kóðann á bakvið þau á mörgum stöðum
	\item Við getum gert föll aðgengileg út fyrir skjalið sem við skilgreindum þau í
	\item Við getum unnið með inntak frá notanda á skilvirkan máta
	\item Föll halda utan um einhverja tiltekna virkni sem við viljum hafa aðgang að og eru skilvirk leið til að afmarka virkni
\end{itemize}

Við höfum hingað til ekki fengist við meira en að átta okkur á grunnvirkni í forritun með hjálp Pyhton en nú erum við komin á þann stað að við getum farið að leysa flókin vandamál.


\section{Að skilgreina föll}
Til þess að skrifa föll þurfum við að læra nýtt lykilorð, \textbf{def}.
Það stendur fyrir define eða að skilgreina, þar sem við erum með því að búa til ákveðna skilgreiningu sem vélin getur svo notað til þess að framkvæma aðgerðir.

Það næsta sem þarf er að búa til nafn á fallið, nafnið er það sem vð notum til þess að beita fallinu okkar eftir að hafa skilgreint það.
Alveg eins og með aðrar breytur þá megum við ekki nota föll fyrr en búið er að skilgreina þau.

Þegar það er komið getum við byrjað að forrita virkni fallsins okkar, allt sem er einum inndrætti innar en def lykilorðið tilheyrir fallinu okkar.


\begin{lstlisting}[caption=Föll skilgreind, label=lst:foll-skilgreining]
# Búum til okkar fyrsta fall, það sem það á að gera er að prenta "Halló Heimur!" því að það er tölvunarfræðileg klisja sem má ekki sleppa.
def prentunarfall():
	# fallið heitir prentunarfall og það er notað með því að kalla í prentunarfall()
	print("Halló Heimur!")
	
# athugið að hér notuðum við lykilorðið def og svo skrifuðum við nafnið á fallinu, það sem fallið gerir er að keyra eina print skipun.
# en hér er ekkert úttak, þar sem við kölluðum ekki í fallið heldur skilgreindum það eingöngu

# til að kalla í fallið og nota það þarf að keyra eftirfarandi línu, að sjálfsögðu eftir að hafa keyrt skilgreininguna að ofan
prentunarfall()
# úttakið verður
# Halló Heimur!
\end{lstlisting}
\section{Viðföng}
Nú höfum við séð að hægt er að búa til skilgreiningar á föllum, en tökum eftir að í kóðabút \ref{lst:foll-skilgreining} þá eru tómir svigar fyrir aftan nafnið á fallinu.
Þessir svigar eru ekki þarna að ástæðulausu og þeir eru ekki tómir í þessum kóðabút að ástæðulausu heldur.

Það sem fer inn í svigana eru svo kölluð viðföng (e. arguments), viðföngin skiptast í tvær tegundir \textbf{stöðubundin} (e. postitional) og \textbf{sjálfgefin} (e. named).
Hægt er að nota bæði í bland og eina viðmiðið er að gefa kost á þeim viðföngum sem notandinn ætti að fá eitthvað um að segja.

Til dæmis ef við værum að raða í íslenska stafrófsröð væri lítið vit í því að bjóða notandanum að setja inn sem viðfang eitthvert annað stafróf.
Eða ef við værum að lóðsa bílstjóra með GPS myndum við ekki vilja leyfa bílstjóranum að setja inn nýjar götur.

Annað sem mikilvægt er að átta sig á er að viðföng fá breytuheiti sem eru aðeins aðgengileg innan fallsins en ekki utan þess. Því ætlum við að skoða nýtt hugtak áður en við skoðum stöðubundin og sjálfgefin viðföng.

\subsection{Gildissvið}
Gildissvið (e. scope) skiptis í staðvært (e. local) og víðvært (e. global). 
Það sem gildissvið þýðir er hvar eitthvað sé aðgengilegt.
Ef við búum til Jupyter vinnubók eða .py skjal þar sem við skilgreinum breytuna x er sú breyta ekki aðgengileg í öðru skjali.
Hins vegar ef við búum til breytu í vinnubók í einhverri sellu, með engum inndrætti, er sú breyta hluti af viðværu gildissviði og aðgengileg öllum sellum og allri virkni sem við viljum beita þessari breytu í.
Hins vegar þegar við skilgreinum föll þá förum við inn á staðvært gildissvið sem þýðir að þegar kallað er í breytu byrjar vélin á að skoða hvort að breytan sé skilgreind innan þess sviðs, ef ekki þá notar hún víðværa gildissviðið.
En ef okkur langar að nota breytu sem var skilgreind innan einhvers falls (einhvers staðværs gildissviðs) þá höfum við ekki aðgang að henni í hinu víðværa gildisssviði.

Það má líta á þetta eins og að horfa á gosbrunn, þar sem víðværa gildissviðið er þar sem vatnið kemur upp efst í brunninum og svo fellur það niður í staðværa gildissviðið sem er neðri hluti brunnsins.
Allt sem er til í efri hlutanum getur neðri hlutinn fengið en það sem er í neðri hlutanum fer ekki upp (í þessari samlíkingu ætlum við að horfa framhjá innri virkni gosbrunnsins og sjá bara fyrir okkur hvernig er að horfa á fallegan gosbrunn sem er á tveimur eða fleiri hæðum).

Ástæða þess að það er mikilvægt að nefna gilssvið að svo stöddu er vegna þess að byrjendur vilja oft ruglast á breytunotkun með þessum hætti.
Vilja meina að viðföng séu skilreindar breytur sem hægt sé að láta fallið hafa aftur, þegar það er líkara hugmyndinni um breytuna en ekki breytan sjálf.

Þetta skýrist þegar við skoðum stöðubundin viðföng.

\subsection{Stöðubundin viðföng}
Stöðubundin viðföng (e. postitional arguements) fá nafn og röðun þegar þau eru sett í skilgreiningu á falli.
Nöfnin á þeim lúta sömu lögmálum og nafnavenjur sem við höfum séð á breytum og er best að hafa nöfnin lýsandi fyrir virkni þeirra.
Dæmi væri:
\newline def prentunarfall(strengur): 
\newline \phantom{----}print(strengur)
\newline
Þegar við köllum í fallið með prentunarfall() þá fáum við villu því að það vantar að setja inn hvað strengur á að vera, strengur er nafnið á viðfanginu en það skiptir ekki öllu máli á þessu stigi málsins, öðru en að villumeldingin sem við fáum upp segir vantar eitt stöðubundið viðfang sem er strengur.
Við þurfum þá að kalla í fallið og setja eitthvað inn í svigann þegar við köllum í það, eins og prentunarfall('Halló Heimur!') sem myndi þá prenta út "Halló Heimur!".

\begin{lstlisting}[caption=Stöðubundin viðföng kynnt, label=lst:foll-stodubundin-kynning]
def fall(a,b,c):
	a**b/c
	
# Þarna eru viðföngin a b og c sett inn í fallið, sem þýðir að þegar fallið er notað þarf að setja gögn, sem á að gefa fallinu, í þessari röð, því það skiptir máli hvernig á að vinna með viðföngin inni í fallinu.
# a þarf að koma fyrst því að það er það sem er hafið í veldið af b sem er svo deilt með c
# þar sem við þekkjum röð aðgerða og þessa tilteknu reiknivirka vitum við að a = 2, b = 3 og c = 5 gefur okkur ekki sömu niðurstöðu og a = 5, b = 2 og c = 3
\end{lstlisting}

Athugum að í kóðabút \ref{lst:foll-stodubundin-kynning} þá er hvorki nafnið á fallinu né viðfanga þess sérlega lýsandi.
Nafnið á fallinu gefur ekki til kynna hvað það gerir og nöfnin á viðföngunum segja ekkert til um hvernig þau verða notuð eða af hvaða týpu þau eiga að vera.
Þetta fall væri mögulega nothæft fyrir okkur sjálf, en um leið og annað fólk á að fara að nota kóðann okkar þá er eins gott að venja sig af því að nota svona ógegnsæjar nafnavenjur.
Betra væri, fyrir þessa tilteknu formúlu að finna eitthvað nafn á hana eða nefna fallið eftir nákvæmri virkni formúlunnar og nefna svo viðföngin eftir því hvar þau eru sett inn í formúluna.

Annað sem vert er að athuga er að þó að við hefðum kallað í fallið þá hefði ekkert skéð, þar sem fallið gerir ekkert við útreikninginn.
Við sjáum í kafla \ref{uk:skilagildi} hvað hægt er að gera annað en að prenta bara út.
En þetta fall hvorki prentar út né skilar og það er eingöngu hugsað til útskýringar á fyrirbærinu stöðubundin viðföng.

Lítum á kóðabút \ref{lst:foll-stodubundin-betra} til að sjá hvernig betur mætti fara með skilgreininguna úr kóðabút \ref{lst:foll-stodubundin-kynning}.

\begin{lstlisting}[caption=Stöðubundin viðföng kynnt, label=lst:foll-stodubundin-betra]
def hefja_i_veldi_og_deila(grunntala,veldisvisir,deiling):	
	grunntala**veldisvisir/deiling

# Þarna er öllum sem hafa aðgang að þessum kóða gerð skýr skil á því hvað þetta fall gerir og greinilegt sé að inntakið eigi að vera tölur
# Fallið gerir þó enn ekkert annað en að vera uppfræðandi því að ekkert kemur út þegar við notum fallið
\end{lstlisting}

Ef við rifjum upp hugtakið gildissvið úr fyrri undirkafla og skoðum hvernig það á við um kóðabút \ref{lst:foll-stodubundin-betra} þá sjáum við að fallið heitir hefja\_i\_veldi\_og\_deila og það tekur við þremur viðföngum sem verða að vera sett inn í þeirri röð sem fallið kallar eftir þeim, fyrst grunntöluna svo töluna sem á að nota sem veldisvísi og svo loks töluna sem á að deila með.

Nú er við hæfi að taka fram hvers konar byrjenda mistök eru algeng hérna og ef meiri skilningur værir fyrir hendi á hvernig gildissvið virka myndu þessi mistök eiga sér sjaldnar stað.
Það er að breyturnar grunntala, veldisvisir og deiling eru hluti af staðværu gildissviði þessa falls, neðri hluta brunnsins sem efri hlutinn getur ekki sótt vatn úr.
Þess vegna getum við ekki kallað í fallið svona: hefja\_i\_veldi\_og\_deila(grunntala,veldisvisir,deiling) því að þá erum við að biðja víðværa gildissviðið (efri hluta brunnsins) um að finna hjá sér einhverjar breytur sem heita þetta til þess að setja inn í staðinn fyrir þessar skilgreiningar.

Ef við horfum aftur til skilgreiningar hrings og myndum búa til fall sem lýsir því hvernig eigi að teikna hring með ákveðna miðju og tiltekin radíus.
Fallið gætið litið svona út: \newline def hringur(radius, midja): \newline \phantom{----}\# það sem fallið gerir. \newline
Nú ef mig langar til að fá einhvern hring í hendurnar get ég ekki sagt við vélina láttu með hafa hring með radíus radius.
Vélin, ef við manngerum hana örlítið, myndi þá segja ,,það er það sem þú átt að segja mér, hvað radíus er, ég veit ekkert hvað það er!''
Til þess að nota fallið þurfum við að gefa annað hvort upp gögn af týpunni sem um var beðið eða breytu sem er aðgengileg utan fallsins (annað hvort úr víðværu gildissviði eða víðara staðværu gildissviði) sem inniheldur gögn af týpunni sem um var beðið.

Tölvan reynir ekki að hafa vit fyrir okkur, hún lagar ekki inntakið þegar við setjum það í augljóslega ranga röð.
Hún annað hvort vinnur með vitlausa inntakið okkar og við fáum í hausinn eitthvað úttak sem við skiljum ekki eða við fáum villu.
\todo{er búið að tala um try except sem mun koma}

\subsection{Sjálfgefin viðfögn}
Ef við viljum vera viss um að við getum unnið með eitthvað viðfang án þess að neyða notandann til þess að gefa okkur það getum við notað sjálfgefin viðföng (e. named arguments, default arguments), einnig kölluð nefnd viðföng.
Þá skilgreinum við fall og búum til skilgreiningu á viðföngunum þar sem við tökum þau fram.
Dæmi væri:
\newline def prentunarfall(strengur = "Halló Heimur!"): 
\newline \phantom{----}print(strengur)
\newline
Ef við köllum í fallið með prentunarfall() og gefum því ekkert viðfang þá notar tölvan skilgreininguna sem er innan svigans þar sem viðföngin eru tekin fram.
Sjáum þetta í kóðabút \ref{lst:foll-sjalfgefin}, hvernig megi nota bæði stöðubundin og sjálfgefin saman og hvernig megi kalla í föll sem eru með bæði.
Þegar bæði er notað saman í bland þá þarf að setja stöðubundnu viðfögnin fremst og svo á eftir þeim koma sjálfgefnu viðföngin.

Athugum að bæði er í lagi að nota sjálfgefin viðföng sem stöðubundin, en þá verðum við líka að setja þau inn í réttri röð, og hins vegar að skrifa inn nafnið á viðfanginu og skilgreina það sem eitthvað (hvort sem það séu einhver gögn sem við setjum beint inn eða notum breytu), einnig er í lagi að sleppa því að taka þau fram.

\begin{lstlisting}[caption=Sjálfgefin viðföng kynnt, label=lst:foll-sjalfgefin]
def hefja_i_veldi_og_deila(grunntala = 1,veldisvisir = 1,deiling = 1):	
	print(grunntala**veldisvisir/deiling)
	
hefja_i_veldi_og_deila() 
# hér köllum við í fallið en gefum því ekkert, við fáum þó enga villu, því sjálfgefnu skilgreiningarnar eru notaðar
# úttakið er
# 1

hefja_i_veldi_og_deila(2, 2, 2)
# hér gefum við fallinu í té tölur í röð eins og þetta séu stöðubundin viðföng
# ef við gefum upp fleiri viðföng fáum við villu, ef við gefum upp færri þá parast þau í þeirri röð sem þau berast
# úttakið verður 
# 2 

hefja_i_veldi_og_deila(deiling = 2)
# hér notum við sjálfgefin gildi fyrir allt nema deiling, við tökum sérstaklega fram hvað það á að vera
# úttakið verður
# 0.5

hefja_i_veldi_og_deila(deiling = 2, veldisvisir = 1, grunntala = 4)
# hér notum við sjálfgefin gildi, í annarri röð en þau voru skilgreind, það veldur ekki villu því að tölvan parar viðföngin eftir nafni
# úttakið verður
# 2

# skoðum núna blöndu, endurskilgreinum sama fallið með nýjum viðföngum:

def hefja_i_veldi_og_deila(grunntala,veldisvisir,deiling = 1):	
	print(grunntala**veldisvisir/deiling)

# Athugum hér að stöðubundnu viðföngin verða að koma á undan.
# köllum nú í fallið með mismunandi aðferðum:

hefja_i_veldi_og_deila() # hér fáum við villu því búist er við að notandi gefi grunntala og veldisvisir í té.

hefja_i_veldi_og_deila(1,2) # hér fáum við á úttakið 2 

hefja_i_veldi_og_deila(1, 2, 2) # hér fáum á úttakið 0.5

hefja_i_veldi_og_deila(1, 2, deiling = 4) # hér fáum við á úttakið 0.25

# notum breytur til að setja inn í fallið:
tala = 2
veldi = 2
deila = 2
hefja_i_veldi_og_deila(tala, veldi, deiling = deila) # hér fáum við á úttakið 2

\end{lstlisting}

\section{Skilagildi}\label{uk:skilagildi}
Nú höfum við séð hvernig á að búa til föll, við höfum séð hvernig á að láta föllin vinna með sjálfgefið inntak og það næsta sem við viljum skoða er hvernig á að láta föllin okkar skila gildum þannig að hægt sé að fá útkomu úr þeim sem megi nota áfram.
Við höfum séð hvernig aðferðir á strengi skila oft til okkar öðrum streng sem byggir á strengnum sem við notuðum aðferðina á (sjá kóðabút \ref{lst:adferdir}), til þess að geta notað úttkomuna þá getum við búið til breytu sem grípur það sem aðferðin \textit{skilar}.
Í kóðabútum \ref{lst:foll-stodubundin-betra} og \ref{lst:foll-sjalfgefin} þá er fallið hefja\_i\_veldi skilgreint, en aldrei er hægt að vinna eitthvað með úttkomuna úr útreikningnum, það sem er gert er annað hvort ekkert eða úttkoman er prentuð.
Það dugar okkur ekki ef við þurfum að nota útreikninginn að þurfa að horfa á það sem vélin skrifar út og skrifa það handvirkt inn sjálf.
Það sem við viljum geta sagt er ,,hey reiknaðu þetta út og notaðu það svo hér, mér er alveg sama hvað það er því að ég treysti því að þú hafir gert það rétt.''
Því að við manngerum tölvuna að sjálfsögðu, hvað gæti farið úrskeiðis?

Til þess að geta nýtt þessa virkni þurfum við að læra nýtt lykilorð sem er \textbf{return} sem þýðir skila, mjög gagnsætt og gott lykilorð (eins og flest lykilorðin sem við höfum séð hingað til, að mati höfundar).
Það sem lykilorðið gerir er svipað break lykilorðinu, þegar vélin kemur að línu þar sem return kemur fram þá gerir fallið ekkert meira en að skila því sem beðið er um og vélin heldur áfram í næstu línu frá því kallað var í fallið.
Sjáum í kóðabút \ref{lst:foll-skilagildi}

\begin{lstlisting}[caption=Hvernig á að láta fall skila gildi með return skipuninni, label=lst:foll-skilagildi]
def hefja_i_veldi_og_deila(grunntala,veldisvisir,deiling = deiling):	
	return grunntala**veldisvisir/deiling
	
# nú höfum við séð mýgrút leiða til að kalla í fallið svo við ætlum að einbeita okkur að því hvernig megi nota það sem fallið skilar í stað þess hvernig eigi að kalla í það með mismunandi viðföngum.
# Athugum að  hefja_i_veldi_og_deila(2, 2, 2) skilar okkur 2

tala = fall(2,2,2)
print(tala)
# hér verður úttakið 2

utreikningur = fall(2,2,2) * 4
print(utreikning)
# hér verður úttakið 8

breyta = utreikningur * tala
print(breyta)
# hér verður úttakið 16
\end{lstlisting}
 
Nú höfum við skilað einu gildi sem er heiltala eða fleytitala og unnið með hana með þeim aðgerðum og reiknivirkjum sem okkur langaði til að prófa.
Hægt er að skila gögnum af hvaða týpu sem er, og jafnvel fleiru en einu gildi í einu, og það af mismunandi týpum.

Sjáum í kóðabút \ref{lst:foll-ndir-skilagildi} hvernig hægt er að skila mörgum gildum og setja þau í breytu eða breytur.

\begin{lstlisting}[caption=Hvernig á að skila mörgum gildum, label=lst:foll-ndir-skilagildi]
def skilum_morgum_gildum(strengur, tala, listi):
	# inni í fallinu gerum við einhverja töfra, eins og að telja hversu oft strengurinn kemur fyrir í listanum
	# og hversu margar tölur eru stærri en talan.
	skilatala = 0
	strengja_talning = 0
	for x in listi:
		if x == strengur:
			strengja_talning +=1
		if(type(x) == int or type(x) == float ):
			if (tala > x):
				skilatala += 1
	return skilatala, strengja_talning, listi
\end{lstlisting}

\section{Lokun}